<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Analytics Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 3rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .nav-tabs {
            display: flex; justify-content: center; margin-bottom: 30px;
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            border-radius: 50px; padding: 10px; flex-wrap: wrap;
        }
        .nav-tab {
            padding: 15px 30px; margin: 5px; border: none; border-radius: 50px;
            background: transparent; color: white; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease;
        }
        .nav-tab.active {
            background: white; color: #764ba2; transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .nav-tab:hover:not(.active) { background: rgba(255,255,255,0.2); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px; }
        .scorecard {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            border-radius: 20px; padding: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        .scorecard h2 { font-size: 2.5rem; margin-bottom: 30px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .teams-score { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .team-score {
            background: rgba(255,255,255,0.2); border-radius: 15px; padding: 20px; text-align: center;
        }
        .team-name { font-size: 1.2rem; opacity: 0.8; margin-bottom: 10px; }
        .team-score-value { font-size: 2.5rem; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .current-batters {
            background: rgba(118, 75, 162, 0.3); border-radius: 15px; padding: 20px; margin-bottom: 20px;
        }
        .current-batters h3 { margin-bottom: 15px; font-size: 1.3rem; }
        .batter-row {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 15px;
            padding: 10px; margin-bottom: 5px; background: rgba(255,255,255,0.1); border-radius: 8px;
        }
        .batter-header { font-weight: bold; opacity: 0.8; font-size: 0.9rem; }
        .analytics-panel {
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            border-radius: 20px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        .analytics-panel h3 { margin-bottom: 20px; font-size: 1.5rem; }
        .player-card {
            background: rgba(255, 152, 0, 0.8); border-radius: 12px; padding: 15px;
            margin-bottom: 15px; transition: transform 0.3s ease;
        }
        .player-card:hover { transform: translateX(5px); }
        .player-name { font-weight: bold; margin-bottom: 5px; }
        .player-team { font-size: 0.9rem; opacity: 0.8; margin-bottom: 10px; }
        .player-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; }
        .management-section {
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            border-radius: 20px; padding: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; flex-wrap: wrap;
        }
        .section-title { font-size: 2rem; margin-bottom: 10px; }
        .btn {
            padding: 12px 25px; border: none; border-radius: 8px; font-size: 1rem;
            cursor: pointer; transition: all 0.3s ease; margin: 5px;
        }
        .add-btn { background: #4CAF50; color: white; padding: 12px 25px; border-radius: 50px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-save { background: #4CAF50; color: white; }
        .btn-cancel { background: #f44336; color: white; }
        .btn-edit { background: #2196F3; color: white; padding: 8px 12px; font-size: 0.9rem; }
        .btn-delete { background: #f44336; color: white; padding: 8px 12px; font-size: 0.9rem; }
        .form-container {
            background: rgba(255,255,255,0.2); border-radius: 15px; padding: 25px;
            margin-bottom: 25px; display: none;
        }
        .form-container.show { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-bottom: 20px;
        }
        .form-input, .form-select {
            padding: 12px 15px; border: none; border-radius: 8px; font-size: 1rem;
            background: rgba(255,255,255,0.9); color: #333;
        }
        .form-input::placeholder { color: #666; }
        .form-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .data-table {
            background: rgba(255,255,255,0.1); border-radius: 15px;
            overflow: hidden; margin-top: 20px; overflow-x: auto;
        }
        .table { width: 100%; border-collapse: collapse; min-width: 700px; }
        .table th, .table td {
            padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .table th { background: rgba(255,255,255,0.2); font-weight: bold; font-size: 1.1rem; }
        .table tr:hover { background: rgba(255,255,255,0.1); }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .status-live { background: #4CAF50; color: white; }
        .status-completed { background: #2196F3; color: white; }
        .status-upcoming { background: #FF9800; color: white; }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .loading { text-align: center; padding: 50px; font-size: 1.2rem; opacity: 0.8; }
        .error {
            background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336;
            border-radius: 8px; padding: 15px; margin: 15px 0; color: #ffebee;
        }
        .success {
            background: rgba(76, 175, 80, 0.2); border: 1px solid #4CAF50;
            border-radius: 8px; padding: 15px; margin: 15px 0; color: #e8f5e8;
        }
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .teams-score { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .section-header { flex-direction: column; align-items: stretch; }
            .nav-tabs { flex-direction: column; }
            .nav-tab { margin: 5px 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèè CRICKET ANALYTICS</h1>
            <p>Complete Dashboard with Live Scorecard & Management System</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('scorecard')">üèÜ Live Scorecard</button>
            <button class="nav-tab" onclick="showTab('live-data')">üåê Live Cricket Data</button>
            <button class="nav-tab" onclick="showTab('players')">üë• Player Management</button>
            <button class="nav-tab" onclick="showTab('matches')">üìä Match Management</button>
        </div>

        <div id="scorecard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="scorecard">
                    <h2>LIVE SCORECARD</h2>
                    <div id="live-match-container">
                        <div class="loading">Loading live match data...</div>
                    </div>
                </div>
                <div class="analytics-panel">
                    <h3>üìà PLAYER ANALYTICS</h3>
                    <div id="analytics-container">
                        <div class="loading">Loading analytics...</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="live-data" class="tab-content">
            <div class="management-section">
                <div class="section-header">
                    <h2 class="section-title">Live Cricket Data from API</h2>
                    <button class="add-btn" onclick="syncLiveData()">üîÑ Sync Live Data</button>
                </div>
                <div class="form-buttons">
                    <button class="btn" style="background: #9C27B0;" onclick="testCricketAPI()">üß™ Test API Connection</button>
                    <button class="btn btn-save" onclick="loadCurrentMatches()">üî¥ Current Matches</button>
                    <button class="btn btn-edit" onclick="loadRecentMatches()">üìÖ Recent Matches</button>
                    <button class="btn" style="background: #FF9800;" onclick="loadUpcomingMatches()">‚è∞ Upcoming Matches</button>
                </div>
                <div id="live-data-container" class="data-table">
                    <div class="loading">Click on any button above to load live cricket data</div>
                </div>
            </div>
        </div>

        <div id="players" class="tab-content">
            <div class="management-section">
                <div class="section-header">
                    <h2 class="section-title">Player Management</h2>
                    <button class="add-btn" onclick="showAddForm('player')">‚ûï Add Player</button>
                </div>
                <div id="player-form" class="form-container">
                    <h3>Add New Player</h3>
                    <div class="form-grid">
                        <input type="text" id="player-name" class="form-input" placeholder="Player Name" required>
                        <input type="text" id="player-team" class="form-input" placeholder="Team" required>
                        <input type="number" id="player-runs" class="form-input" placeholder="Runs" value="0">
                        <input type="number" id="player-balls" class="form-input" placeholder="Balls" value="0">
                        <input type="number" id="player-fours" class="form-input" placeholder="Fours" value="0">
                        <input type="number" id="player-sixes" class="form-input" placeholder="Sixes" value="0">
                    </div>
                    <div class="form-buttons">
                        <button class="btn btn-save" onclick="savePlayer()">üíæ Save Player</button>
                        <button class="btn btn-cancel" onclick="hideAddForm('player')">‚ùå Cancel</button>
                    </div>
                </div>
                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th><th>Team</th><th>Runs</th><th>Balls</th>
                                <th>4s</th><th>6s</th><th>Strike Rate</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="players-tbody">
                            <tr><td colspan="8" class="loading">Loading players...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="matches" class="tab-content">
            <div class="management-section">
                <div class="section-header">
                    <h2 class="section-title">Match Management</h2>
                    <button class="add-btn" onclick="showAddForm('match')">‚ûï Add Match</button>
                </div>
                <div id="match-form" class="form-container">
                    <h3>Add New Match</h3>
                    <div class="form-grid">
                        <input type="text" id="match-team1" class="form-input" placeholder="Team 1" required>
                        <input type="text" id="match-team2" class="form-input" placeholder="Team 2" required>
                        <input type="text" id="match-score1" class="form-input" placeholder="Team 1 Score" value="0-0">
                        <input type="text" id="match-score2" class="form-input" placeholder="Team 2 Score" value="0-0">
                        <select id="match-status" class="form-select">
                            <option value="Upcoming">Upcoming</option>
                            <option value="Live">Live</option>
                            <option value="Completed">Completed</option>
                        </select>
                        <input type="text" id="match-overs" class="form-input" placeholder="Overs" value="0.0">
                        <input type="text" id="match-venue" class="form-input" placeholder="Venue">
                        <input type="date" id="match-date" class="form-input">
                    </div>
                    <div class="form-buttons">
                        <button class="btn btn-save" onclick="saveMatch()">üíæ Save Match</button>
                        <button class="btn btn-cancel" onclick="hideAddForm('match')">‚ùå Cancel</button>
                    </div>
                </div>
                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Team 1</th><th>Team 2</th><th>Score 1</th><th>Score 2</th>
                                <th>Status</th><th>Overs</th><th>Venue</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="matches-tbody">
                            <tr><td colspan="8" class="loading">Loading matches...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        let currentEditingId = null;

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'scorecard') {
                loadLiveScorecard();
                loadAnalytics();
            } else if (tabName === 'players') {
                loadPlayers();
            } else if (tabName === 'matches') {
                loadMatches();
            }
        }

        async function apiRequest(endpoint, method = 'GET', data = null) {
            const options = {
                method: method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (data) options.body = JSON.stringify(data);
            
            try {
                const response = await fetch(API_BASE_URL + endpoint, options);
                const result = await response.json();
                if (!response.ok) throw new Error(result.message || 'API request failed');
                return result;
            } catch (error) {
                console.error('API Error:', error);
                showMessage(error.message, 'error');
                throw error;
            }
        }

        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            setTimeout(() => messageDiv.remove(), 5000);
        }

        async function testCricketAPI() {
            try {
                const container = document.getElementById('live-data-container');
                container.innerHTML = '<div class="loading">Testing Cricket Data API...</div>';
                const response = await apiRequest('/test/cricket-api');
                
                const resultDiv = document.createElement('div');
                if (response.status === 'success') {
                    resultDiv.className = 'success';
                    resultDiv.innerHTML = '<h3>‚úÖ API Connection Successful!</h3><p>' + response.message + '</p>';
                } else {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = '<h3>‚ùå API Connection Failed</h3><p>' + response.message + '</p>';
                }
                container.innerHTML = '';
                container.appendChild(resultDiv);
            } catch (error) {
                document.getElementById('live-data-container').innerHTML = 
                    '<div class="error">Connection test failed: ' + error.message + '</div>';
            }
        }

        async function loadCurrentMatches() {
            try {
                const container = document.getElementById('live-data-container');
                container.innerHTML = '<div class="loading">Loading current matches...</div>';
                const response = await apiRequest('/live/current-matches');
                const matches = response.data;
                
                if (matches.length === 0) {
                    container.innerHTML = '<div class="loading">No current matches found</div>';
                    return;
                }
                
                const table = createTable(['Match', 'Status', 'Teams', 'Scores', 'Venue', 'Type', 'Actions']);
                const tbody = table.querySelector('tbody');
                
                matches.forEach(match => {
                    const row = document.createElement('tr');
                    
                    // Match name
                    const matchCell = document.createElement('td');
                    matchCell.innerHTML = '<strong>' + (match.name || 'Match') + '</strong>';
                    row.appendChild(matchCell);
                    
                    // Status
                    const statusCell = document.createElement('td');
                    statusCell.innerHTML = '<span class="status-badge status-live">LIVE</span>';
                    row.appendChild(statusCell);
                    
                    // Teams
                    const teamsCell = document.createElement('td');
                    if (match.teams && match.teams.length >= 2) {
                        teamsCell.textContent = match.teams[0].name + ' vs ' + match.teams[1].name;
                    } else {
                        teamsCell.textContent = 'Teams TBA';
                    }
                    row.appendChild(teamsCell);
                    
                    // Scores
                    const scoresCell = document.createElement('td');
                    if (match.score && match.score.length >= 2) {
                        const score1 = (match.score[0].r || 0) + '-' + (match.score[0].w || 0);
                        const score2 = (match.score[1].r || 0) + '-' + (match.score[1].w || 0);
                        scoresCell.textContent = score1 + ' | ' + score2;
                    } else {
                        scoresCell.textContent = 'Scores TBA';
                    }
                    row.appendChild(scoresCell);
                    
                    // Venue, Type, Actions
                    const venueCell = document.createElement('td');
                    venueCell.textContent = match.venue || 'Venue TBA';
                    row.appendChild(venueCell);
                    
                    const typeCell = document.createElement('td');
                    typeCell.textContent = match.matchType || 'N/A';
                    row.appendChild(typeCell);
                    
                    const actionsCell = document.createElement('td');
                    const detailsBtn = document.createElement('button');
                    detailsBtn.className = 'btn btn-edit';
                    detailsBtn.textContent = 'üëÅÔ∏è Details';
                    detailsBtn.onclick = () => viewMatchDetails(match.id);
                    actionsCell.appendChild(detailsBtn);
                    row.appendChild(actionsCell);
                    
                    tbody.appendChild(row);
                });
                
                container.innerHTML = '';
                container.appendChild(table);
            } catch (error) {
                document.getElementById('live-data-container').innerHTML = 
                    '<div class="error">Failed to load current matches</div>';
            }
        }

        async function loadRecentMatches() {
            const container = document.getElementById('live-data-container');
            container.innerHTML = '<div class="loading">Recent matches feature - showing demo data</div>';
        }

        async function loadUpcomingMatches() {
            const container = document.getElementById('live-data-container');
            container.innerHTML = '<div class="loading">Upcoming matches feature - showing demo data</div>';
        }

        function createTable(headers) {
            const table = document.createElement('table');
            table.className = 'table';
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            const tbody = document.createElement('tbody');
            table.appendChild(tbody);
            return table;
        }

        async function viewMatchDetails(matchId) {
            showMessage('Match details feature - ID: ' + matchId, 'success');
        }

        async function syncLiveData() {
            try {
                showMessage('Syncing live cricket data...', 'success');
                const response = await apiRequest('/sync/live-data', 'POST');
                if (response.success) {
                    showMessage('Successfully synced ' + response.synced_count + ' matches!', 'success');
                    loadMatches();
                } else {
                    showMessage(response.message || 'Failed to sync live data', 'error');
                }
            } catch (error) {
                showMessage('Failed to sync live data', 'error');
            }
        }

        async function loadLiveScorecard() {
            try {
                const response = await apiRequest('/dashboard/live');
                const liveData = response.data;
                const container = document.getElementById('live-match-container');
                
                if (!liveData || Object.keys(liveData).length === 0) {
                    container.innerHTML = '<div class="loading">No live match data available</div>';
                    return;
                }
                
                container.innerHTML = 
                    '<div class="teams-score">' +
                        '<div class="team-score">' +
                            '<div class="team-name">' + (liveData.team1 || 'Team 1') + '</div>' +
                            '<div class="team-score-value">' + (liveData.score1 || '0-0') + '</div>' +
                        '</div>' +
                        '<div class="team-score">' +
                            '<div class="team-name">' + (liveData.team2 || 'Team 2') + '</div>' +
                            '<div class="team-score-value">' + (liveData.score2 || '0-0') + '</div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="current-batters">' +
                        '<h3>CURRENT BATTERS (' + (liveData.team1 || 'Team 1') + ')</h3>' +
                        '<div class="batter-row batter-header">' +
                            '<div>BATTER</div><div>R</div><div>B</div><div>4s</div><div>SR</div>' +
                        '</div>' +
                        (liveData.current_batters && liveData.current_batters.length > 0 ? 
                            liveData.current_batters.map(batter => 
                                '<div class="batter-row">' +
                                    '<div>' + batter.name + '</div>' +
                                    '<div>' + batter.runs + '</div>' +
                                    '<div>' + batter.balls + '</div>' +
                                    '<div>' + batter.fours + '</div>' +
                                    '<div>' + batter.strike_rate + '</div>' +
                                '</div>'
                            ).join('') :
                            '<div class="batter-row"><div colspan="5">No current batters</div></div>'
                        ) +
                    '</div>' +
                    '<div style="text-align: center; margin-top: 20px;">' +
                        '<div style="font-size: 1.2rem; margin-bottom: 10px;">' +
                            '<strong>Status:</strong> <span class="status-badge status-' + (liveData.status || 'upcoming').toLowerCase() + '">' + (liveData.status || 'TBA') + '</span>' +
                        '</div>' +
                        '<div style="font-size: 1.1rem; opacity: 0.9;">' +
                            '<strong>Overs:</strong> ' + (liveData.overs || '0.0') + ' | <strong>Venue:</strong> ' + (liveData.venue || 'TBA') +
                        '</div>' +
                    '</div>';
            } catch (error) {
                document.getElementById('live-match-container').innerHTML = 
                    '<div class="error">Failed to load live match data</div>';
            }
        }

        async function loadAnalytics() {
            try {
                const response = await apiRequest('/dashboard/analytics');
                const analytics = response.data;
                const container = document.getElementById('analytics-container');
                
                let analyticsHTML = '<div style="margin-bottom: 20px;">' +
                    '<h4 style="margin-bottom: 15px; opacity: 0.9;">Top Run Scorers</h4>';
                
                if (analytics.top_run_scorers && analytics.top_run_scorers.length > 0) {
                    analytics.top_run_scorers.slice(0, 4).forEach(player => {
                        analyticsHTML += 
                            '<div class="player-card">' +
                                '<div class="player-name">' + player.name + '</div>' +
                                '<div class="player-team">' + player.team + '</div>' +
                                '<div class="player-stats">' +
                                    '<div>Runs: ' + player.runs + '</div>' +
                                    '<div>SR: ' + player.strike_rate + '</div>' +
                                '</div>' +
                            '</div>';
                    });
                } else {
                    analyticsHTML += '<div class="loading">No player data available</div>';
                }
                
                analyticsHTML += '</div>';
                container.innerHTML = analyticsHTML;
            } catch (error) {
                document.getElementById('analytics-container').innerHTML = 
                    '<div class="error">Failed to load analytics</div>';
            }
        }

        async function loadPlayers() {
            try {
                const response = await apiRequest('/players');
                const players = response.data;
                const tbody = document.getElementById('players-tbody');
                
                if (!players || players.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="loading">No players found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                players.forEach(player => {
                    const row = document.createElement('tr');
                    [player.name, player.team, player.runs, player.balls, player.fours, player.sixes, player.strike_rate].forEach(data => {
                        const cell = document.createElement('td');
                        cell.textContent = data;
                        row.appendChild(cell);
                    });
                    
                    const actionsCell = document.createElement('td');
                    actionsCell.className = 'action-buttons';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-edit';
                    editBtn.textContent = '‚úèÔ∏è Edit';
                    editBtn.onclick = () => editPlayer(player.id);
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-delete';
                    deleteBtn.textContent = 'üóëÔ∏è Delete';
                    deleteBtn.onclick = () => deletePlayer(player.id);
                    
                    actionsCell.appendChild(editBtn);
                    actionsCell.appendChild(deleteBtn);
                    row.appendChild(actionsCell);
                    tbody.appendChild(row);
                });
            } catch (error) {
                document.getElementById('players-tbody').innerHTML = 
                    '<tr><td colspan="8" class="error">Failed to load players</td></tr>';
            }
        }

        async function savePlayer() {
            const playerData = {
                name: document.getElementById('player-name').value,
                team: document.getElementById('player-team').value,
                runs: parseInt(document.getElementById('player-runs').value) || 0,
                balls: parseInt(document.getElementById('player-balls').value) || 0,
                fours: parseInt(document.getElementById('player-fours').value) || 0,
                sixes: parseInt(document.getElementById('player-sixes').value) || 0
            };
            
            if (!playerData.name || !playerData.team) {
                showMessage('Player name and team are required', 'error');
                return;
            }
            
            try {
                if (currentEditingId) {
                    await apiRequest('/players/' + currentEditingId, 'PUT', playerData);
                    showMessage('Player updated successfully');
                    currentEditingId = null;
                } else {
                    await apiRequest('/players', 'POST', playerData);
                    showMessage('Player added successfully');
                }
                hideAddForm('player');
                loadPlayers();
            } catch (error) {
                // Error handled in apiRequest
            }
        }

        async function editPlayer(id) {
            try {
                const response = await apiRequest('/players/' + id);
                const player = response.data;
                
                document.getElementById('player-name').value = player.name;
                document.getElementById('player-team').value = player.team;
                document.getElementById('player-runs').value = player.runs;
                document.getElementById('player-balls').value = player.balls;
                document.getElementById('player-fours').value = player.fours;
                document.getElementById('player-sixes').value = player.sixes;
                
                currentEditingId = id;
                showAddForm('player');
                document.querySelector('#player-form h3').textContent = 'Edit Player';
            } catch (error) {
                // Error handled in apiRequest
            }
        }

        async function deletePlayer(id) {
            if (!confirm('Are you sure you want to delete this player?')) return;
            
            try {
                await apiRequest('/players/' + id, 'DELETE');
                showMessage('Player deleted successfully');
                loadPlayers();
            } catch (error) {
                // Error handled in apiRequest
            }
        }

        async function loadMatches() {
            try {
                const response = await apiRequest('/matches');
                const matches = response.data;
                const tbody = document.getElementById('matches-tbody');
                
                if (!matches || matches.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="loading">No matches found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                matches.forEach(match => {
                    const row = document.createElement('tr');
                    
                    [match.team1, match.team2, match.score1, match.score2].forEach(data => {
                        const cell = document.createElement('td');
                        cell.textContent = data;
                        row.appendChild(cell);
                    });
                    
                    const statusCell = document.createElement('td');
                    const statusBadge = document.createElement('span');
                    statusBadge.className = 'status-badge status-' + match.status.toLowerCase();
                    statusBadge.textContent = match.status;
                    statusCell.appendChild(statusBadge);
                    row.appendChild(statusCell);
                    
                    [match.overs, match.venue || 'TBA'].forEach(data => {
                        const cell = document.createElement('td');
                        cell.textContent = data;
                        row.appendChild(cell);
                    });
                    
                    const actionsCell = document.createElement('td');
                    actionsCell.className = 'action-buttons';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-edit';
                    editBtn.textContent = '‚úèÔ∏è Edit';
                    editBtn.onclick = () => editMatch(match.id);
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-delete';
                    deleteBtn.textContent = 'üóëÔ∏è Delete';
                    deleteBtn.onclick = () => deleteMatch(match.id);
                    
                    actionsCell.appendChild(editBtn);
                    actionsCell.appendChild(deleteBtn);
                    row.appendChild(actionsCell);
                    tbody.appendChild(row);
                });
            } catch (error) {
                document.getElementById('matches-tbody').innerHTML = 
                    '<tr><td colspan="8" class="error">Failed to load matches</td></tr>';
            }
        }

        async function saveMatch() {
            const matchData = {
                team1: document.getElementById('match-team1').value,
                team2: document.getElementById('match-team2').value,
                score1: document.getElementById('match-score1').value || '0-0',
                score2: document.getElementById('match-score2').value || '0-0',
                status: document.getElementById('match-status').value,
                overs: document.getElementById('match-overs').value || '0.0',
                venue: document.getElementById('match-venue').value,
                match_date: document.getElementById('match-date').value
            };
            
            if (!matchData.team1 || !matchData.team2) {
                showMessage('Both team names are required', 'error');
                return;
            }
            
            try {
                if (currentEditingId) {
                    await apiRequest('/matches/' + currentEditingId, 'PUT', matchData);
                    showMessage('Match updated successfully');
                    currentEditingId = null;
                } else {
                    await apiRequest('/matches', 'POST', matchData);
                    showMessage('Match added successfully');
                }
                hideAddForm('match');
                loadMatches();
            } catch (error) {
                // Error handled in apiRequest
            }
        }

        async function editMatch(id) {
            try {
                const response = await apiRequest('/matches/' + id);
                const match = response.data;
                
                document.getElementById('match-team1').value = match.team1;
                document.getElementById('match-team2').value = match.team2;
                document.getElementById('match-score1').value = match.score1;
                document.getElementById('match-score2').value = match.score2;
                document.getElementById('match-status').value = match.status;
                document.getElementById('match-overs').value = match.overs;
                document.getElementById('match-venue').value = match.venue || '';
                document.getElementById('match-date').value = match.match_date || '';
                
                currentEditingId = id;
                showAddForm('match');
                document.querySelector('#match-form h3').textContent = 'Edit Match';
            } catch (error) {
                // Error handled in apiRequest
            }
        }

        async function deleteMatch(id) {
            if (!confirm('Are you sure you want to delete this match?')) return;
            
            try {
                await apiRequest('/matches/' + id, 'DELETE');
                showMessage('Match deleted successfully');
                loadMatches();
            } catch (error) {
                // Error handled in apiRequest
            }
        }

        function showAddForm(type) {
            document.getElementById(type + '-form').classList.add('show');
            if (!currentEditingId) {
                const title = type === 'player' ? 'Add New Player' : 'Add New Match';
                document.querySelector('#' + type + '-form h3').textContent = title;
            }
        }

        function hideAddForm(type) {
            document.getElementById(type + '-form').classList.remove('show');
            const form = document.getElementById(type + '-form');
            const inputs = form.querySelectorAll('.form-input, .form-select');
            inputs.forEach(input => {
                if (input.type === 'number') {
                    input.value = 0;
                } else if (input.type === 'date') {
                    input.value = '';
                } else {
                    input.value = input.defaultValue || '';
                }
            });
            currentEditingId = null;
            const title = type === 'player' ? 'Add New Player' : 'Add New Match';
            document.querySelector('#' + type + '-form h3').textContent = title;
        }

        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('match-date').value = today;
            loadLiveScorecard();
            loadAnalytics();
            
            setInterval(() => {
                if (document.getElementById('scorecard').classList.contains('active')) {
                    loadLiveScorecard();
                    loadAnalytics();
                }
            }, 30000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideAddForm('player');
                hideAddForm('match');
            }
            if (e.ctrlKey) {
                if (e.key === '1') {
                    e.preventDefault();
                    showTab('scorecard');
                } else if (e.key === '2') {
                    e.preventDefault();
                    showTab('live-data');
                } else if (e.key === '3') {
                    e.preventDefault();
                    showTab('players');
                } else if (e.key === '4') {
                    e.preventDefault();
                    showTab('matches');
                }
            }
        });
    </script>
</body>
</html>
