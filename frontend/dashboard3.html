<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèè Cricket Analytics Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        
        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: #5a6fd8;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .card {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .btn {
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #667eea;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèè Cricket Analytics Dashboard</h1>
            <p>Simple cricket data management system</p>
        </div>

        <div class="nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
            <button class="nav-btn" onclick="showSection('teams')">Teams</button>
            <button class="nav-btn" onclick="showSection('players')">Players</button>
            <button class="nav-btn" onclick="showSection('sql')">SQL Console</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <h2>Dashboard</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalTeams">0</div>
                    <div class="stat-label">Teams</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalPlayers">0</div>
                    <div class="stat-label">Players</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMatches">0</div>
                    <div class="stat-label">Matches</div>
                </div>
            </div>

            <div class="card">
                <h3>System Status</h3>
                <div id="systemStatus">
                    <div class="loading">Click "Check Status" to test connection</div>
                </div>
                <button class="btn" onclick="checkStatus()">Check Status</button>
            </div>

            <div class="card">
                <h3>Quick Actions</h3>
                <button class="btn" onclick="createSampleData()">Create Sample Data</button>
                <button class="btn" onclick="testAPI()">Test Cricket API</button>
            </div>

            <div class="card">
                <h3>Instructions</h3>
                <div class="info">
                    <strong>Getting Started:</strong><br>
                    1. Click "Check Status" to verify backend connection<br>
                    2. Click "Create Sample Data" to add teams and players<br>
                    3. Use the Teams and Players tabs to view data<br>
                    4. Try SQL queries in the SQL Console tab
                </div>
            </div>
        </div>

        <!-- Teams Section -->
        <div id="teams" class="section">
            <h2>Teams</h2>
            <div class="card">
                <button class="btn" onclick="loadTeams()">Load Teams</button>
                <div id="teamsList">
                    <div class="loading">Click "Load Teams" to see teams</div>
                </div>
            </div>
        </div>

        <!-- Players Section -->
        <div id="players" class="section">
            <h2>Players</h2>
            <div class="card">
                <button class="btn" onclick="loadPlayers()">Load Players</button>
                <div id="playersList">
                    <div class="loading">Click "Load Players" to see players</div>
                </div>
            </div>
        </div>

        <!-- SQL Console Section -->
        <div id="sql" class="section">
            <h2>SQL Console</h2>
            <div class="card">
                <h3>Execute SQL Query</h3>
                <div class="info">
                    <strong>Sample Queries:</strong><br>
                    ‚Ä¢ <code>SELECT * FROM team;</code><br>
                    ‚Ä¢ <code>SELECT * FROM player;</code><br>
                    ‚Ä¢ <code>SELECT p.name, t.name as team FROM player p JOIN team t ON p.team_id = t.id;</code>
                </div>
                <textarea id="sqlQuery" placeholder="Enter SQL query here...">SELECT * FROM team;</textarea>
                <br>
                <button class="btn" onclick="executeQuery()">Execute Query</button>
                <button class="btn" onclick="clearQuery()">Clear</button>
                
                <div id="queryResult"></div>
            </div>
        </div>
    </div>

    <script>
        // API configuration - CORRECTED URL
        const API_BASE = 'http://localhost:8080/api';

        // Navigation function
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }

        // Check system status
        async function checkStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '<div class="loading">Checking status...</div>';
            
            try {
                console.log('Fetching:', `${API_BASE}/database/status`);
                const response = await fetch(`${API_BASE}/database/status`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                statusDiv.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ Status: ${data.status}</strong><br>
                        Database: ${data.database_type}<br>
                        Teams: ${data.tables?.teams || 0}<br>
                        Players: ${data.tables?.players || 0}<br>
                        Matches: ${data.tables?.matches || 0}
                    </div>
                `;
                
                // Update stats
                document.getElementById('totalTeams').textContent = data.tables?.teams || 0;
                document.getElementById('totalPlayers').textContent = data.tables?.players || 0;
                document.getElementById('totalMatches').textContent = data.tables?.matches || 0;
                
            } catch (error) {
                console.error('Status check error:', error);
                statusDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Error:</strong> ${error.message}<br>
                        <small>Make sure backend is running on http://localhost:8080</small>
                    </div>
                `;
            }
        }

        // Create sample data
        async function createSampleData() {
            try {
                console.log('Creating sample data...');
                const response = await fetch(`${API_BASE}/create-sample-data`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Sample data response:', data);
                
                if (data.status === 'success') {
                    alert(`‚úÖ Success!\nTeams: ${data.teams_created}\nPlayers: ${data.players_created}`);
                    checkStatus(); // Refresh stats
                } else {
                    alert(`‚ùå Error: ${data.message}`);
                }
            } catch (error) {
                console.error('Create sample data error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Test Cricket API
        async function testAPI() {
            try {
                const response = await fetch(`${API_BASE}/test-cricket-api`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    alert(`‚úÖ API Test Successful!\nData count: ${data.data_count}`);
                } else {
                    alert(`‚ùå API Error: ${data.message}`);
                }
            } catch (error) {
                console.error('API test error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Load teams
        async function loadTeams() {
            const container = document.getElementById('teamsList');
            container.innerHTML = '<div class="loading">Loading teams...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/teams`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Teams data:', data);
                
                if (data.teams && data.teams.length > 0) {
                    let html = '<table><tr><th>Name</th><th>Short Name</th><th>Country</th></tr>';
                    data.teams.forEach(team => {
                        html += `<tr><td>${team.name}</td><td>${team.short_name || ''}</td><td>${team.country || ''}</td></tr>`;
                    });
                    html += '</table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="info">No teams found. Click "Create Sample Data" first.</div>';
                }
            } catch (error) {
                console.error('Load teams error:', error);
                container.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Load players
        async function loadPlayers() {
            const container = document.getElementById('playersList');
            container.innerHTML = '<div class="loading">Loading players...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/players`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Players data:', data);
                
                if (data.players && data.players.length > 0) {
                    let html = '<table><tr><th>Name</th><th>Team</th><th>Role</th><th>Country</th></tr>';
                    data.players.forEach(player => {
                        html += `<tr><td>${player.name}</td><td>${player.team || ''}</td><td>${player.role || ''}</td><td>${player.country || ''}</td></tr>`;
                    });
                    html += '</table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="info">No players found. Click "Create Sample Data" first.</div>';
                }
            } catch (error) {
                console.error('Load players error:', error);
                container.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Execute SQL query
        async function executeQuery() {
            const query = document.getElementById('sqlQuery').value.trim();
            const resultDiv = document.getElementById('queryResult');
            
            if (!query) {
                resultDiv.innerHTML = '<div class="error">Please enter a query</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Executing query...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/execute-sql`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Query result:', data);
                
                if (data.status === 'success') {
                    if (data.rows && data.rows.length > 0) {
                        let html = `<div class="success">Query executed successfully! ${data.count} rows returned.</div>`;
                        html += '<table><tr>';
                        
                        // Headers
                        Object.keys(data.rows[0]).forEach(key => {
                            html += `<th>${key}</th>`;
                        });
                        html += '</tr>';
                        
                        // Rows
                        data.rows.forEach(row => {
                            html += '<tr>';
                            Object.values(row).forEach(value => {
                                html += `<td>${value !== null ? value : 'NULL'}</td>`;
                            });
                            html += '</tr>';
                        });
                        html += '</table>';
                        
                        resultDiv.innerHTML = html;
                    } else {
                        resultDiv.innerHTML = '<div class="success">Query executed successfully! No rows returned.</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error">Query Error: ${data.message}</div>`;
                }
            } catch (error) {
                console.error('Execute query error:', error);
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Clear query
        function clearQuery() {
            document.getElementById('sqlQuery').value = '';
            document.getElementById('queryResult').innerHTML = '';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded. API Base:', API_BASE);
        });
    </script>
</body>
</html>
